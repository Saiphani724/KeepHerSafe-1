Index: app/src/main/res/layout/activity_main.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<RelativeLayout\r\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n\r\n    android:orientation=\"vertical\"\r\n    android:padding=\"10dp\"\r\n    tools:context=\".MainActivity\">\r\n\r\n\r\n\r\n\r\n    <RelativeLayout\r\n        android:layout_width=\"fill_parent\"\r\n        android:layout_height=\"fill_parent\">\r\n\r\n        <TextView\r\n            android:id=\"@+id/calib\"\r\n            android:layout_width=\"wrap_content\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:text=\"Callibration Mode\"\r\n            android:layout_marginTop=\"60dp\"\r\n            android:textSize=\"16dp\"\r\n            android:layout_marginLeft=\"120dp\">\r\n        </TextView>\r\n        <Switch\r\n            android:id=\"@+id/simpleSwitch\"\r\n            android:layout_width=\"wrap_content\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_below=\"@id/calib\"\r\n            android:layout_marginLeft=\"160dp\"\r\n            />\r\n\r\n        <Button\r\n            android:id=\"@+id/login\"\r\n            android:layout_width=\"wrap_content\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_marginLeft=\"100dp\"\r\n            android:layout_marginTop=\"150dp\"\r\n            android:gravity=\"center\"\r\n            android:onClick=\"startBtService\"\r\n            android:text=\"Reconnect Bluetooth\" />\r\n\r\n\r\n    </RelativeLayout>\r\n\r\n\r\n    <Button\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:onClick=\"startService\"\r\n        android:layout_marginTop=\"750dp\"\r\n        android:text=\"Start Service\" />\r\n    <Button\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:onClick=\"stopService\"\r\n        android:layout_marginTop=\"700dp\"\r\n        android:text=\"Stop Service\" />\r\n\r\n    <androidx.cardview.widget.CardView\r\n        xmlns:card_view=\"http://schemas.android.com/apk/res-auto\"\r\n        android:id=\"@+id/detected\"\r\n        android:layout_gravity=\"center\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_marginTop=\"250dp\"\r\n        android:layout_height=\"100dp\"\r\n        card_view:cardCornerRadius=\"4dp\">\r\n\r\n        <TextView\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"100dp\"\r\n            android:text=\"Heart Rate Detected\"\r\n            android:gravity=\"center\"\r\n            android:id=\"@+id/hearrateTV\"\r\n            />\r\n    </androidx.cardview.widget.CardView>\r\n\r\n    <androidx.cardview.widget.CardView\r\n        xmlns:card_view=\"http://schemas.android.com/apk/res-auto\"\r\n        android:id=\"@+id/calibrate\"\r\n        android:layout_gravity=\"center\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_marginTop=\"370dp\"\r\n        android:layout_height=\"wrap_content\"\r\n        card_view:cardCornerRadius=\"4dp\">\r\n\r\n        <TextView\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_marginTop=\"20dp\"\r\n            android:text=\"Average Heart Rate Calibrated\"\r\n            android:gravity=\"center\"\r\n            android:id=\"@+id/avgHRV\"\r\n            />\r\n    </androidx.cardview.widget.CardView>\r\n\r\n\r\n\r\n\r\n    <Button\r\n        android:id=\"@+id/SOSbutton\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_marginTop=\"650dp\"\r\n        android:text=\"Send SOS \" />\r\n\r\n\r\n</RelativeLayout>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/activity_main.xml	(revision 5b526c8c9f9ec66b68cb6a5c65ab740279bcbe4b)
+++ app/src/main/res/layout/activity_main.xml	(date 1604373120155)
@@ -11,8 +11,6 @@
     tools:context=".MainActivity">
 
 
-
-
     <RelativeLayout
         android:layout_width="fill_parent"
         android:layout_height="fill_parent">
@@ -24,14 +22,15 @@
             android:text="Callibration Mode"
             android:layout_marginTop="60dp"
             android:textSize="16dp"
-            android:layout_marginLeft="120dp">
-        </TextView>
+            android:layout_marginLeft="120dp"/>
+
         <Switch
             android:id="@+id/simpleSwitch"
             android:layout_width="wrap_content"
             android:layout_height="wrap_content"
             android:layout_below="@id/calib"
             android:layout_marginLeft="160dp"
+            android:checked="true"
             />
 
         <Button
Index: app/src/main/java/com/example/keephersafeGPStrial/DangerTrigger.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.keephersafeGPStrial;\r\n\r\nimport android.bluetooth.BluetoothAdapter;\r\nimport android.content.Intent;\r\nimport android.content.SharedPreferences;\r\nimport android.os.Bundle;\r\nimport android.os.Handler;\r\nimport android.os.HandlerThread;\r\nimport android.telephony.SmsManager;\r\nimport android.util.Log;\r\nimport android.view.View;\r\nimport android.widget.Button;\r\nimport android.widget.TextView;\r\n\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.core.app.ActivityCompat;\r\n\r\nimport com.google.firebase.database.DatabaseReference;\r\nimport com.google.firebase.database.FirebaseDatabase;\r\n\r\nimport java.util.ArrayList;\r\n\r\npublic class DangerTrigger extends AppCompatActivity {\r\n    Button cooldown;\r\n    TextView forewarning;\r\n    Handler h;\r\n    boolean flag = false;\r\n    ArrayList<String> phoneNumbers;\r\n    SmsManager smsManager;\r\n    SharedPreferences myPref;\r\n    DBManager dbManager;\r\n    EntityModel model;\r\n    FirebaseDatabase firebase;\r\n    DatabaseReference dref;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.dangertrigger_layout);\r\n\r\n        Bundle data = getIntent().getExtras();\r\n        model = (EntityModel) data.getParcelable(\"DataPoint\");\r\n        Log.d(\"DangerTrigger:OnCreate\",model.pulse + \" pulse received from intent\");\r\n        cooldown = findViewById(R.id.cooldown_btn);\r\n        forewarning = findViewById(R.id.forewarning);\r\n        dbManager = DBManager.getInstance(this);\r\n        firebase = FirebaseDatabase.getInstance();\r\n        dref = firebase.getReference(\"datapoints\");\r\n        cooldown.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                stopTheAlert();\r\n            }\r\n        });\r\n\r\n\r\n\r\n        startNewService();\r\n\r\n    }\r\n\r\n    public void startNewService(){\r\n\r\n        final Runnable r = new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                sendSOS();\r\n            }\r\n        };\r\n        Handler h = new Handler();\r\n\r\n        if(flag == false){\r\n            try {\r\n                h.postDelayed(r, 15000);\r\n            }catch(Exception e){\r\n                e.printStackTrace();\r\n            }\r\n            //sendSOS();\r\n\r\n        }else{\r\n            //h.removeCallbacksAndMessages(null);\r\n        }\r\n\r\n\r\n    }\r\n    public void stopTheAlert() {\r\n        h.removeCallbacksAndMessages(null);\r\n        model.decision = 0;\r\n        dbManager.addDataPoint(model);\r\n        Log.d(\"INSERTING NEW DATAPOINT_STOP:\", model.pulse + \"||\" + model.latitude + \"||\" + model.longitude + \"||\" + model.decision);\r\n        String id = dref.push().getKey();\r\n        dref.child(id).setValue(model);\r\n        flag = true;\r\n        Intent i = new Intent(this,MainActivity.class);\r\n        startActivity(i);\r\n\r\n    }\r\n    public void sendSOS() {\r\n        if(flag == true){\r\n            Log.d(\"DangerTriggerClass\",\"SOS stopped\");\r\n            return;\r\n        }\r\n        myPref = getSharedPreferences(\"MySharedPref\",MODE_PRIVATE);\r\n        model.decision = 1;\r\n        dbManager.addDataPoint(model);\r\n        Log.d(\"INSERTING NEW DATAPOINT_SOS:\", model.pulse + \"||\" + model.latitude + \"||\" + model.longitude+\"||\" + model.decision);\r\n        String id = dref.push().getKey();\r\n        dref.child(id).setValue(model);\r\n        myPref = getSharedPreferences(\"MySharedPref\",MODE_PRIVATE);\r\n        smsManager = SmsManager.getDefault();\r\n        phoneNumbers = new ArrayList<>();\r\n//        phoneNumbers.add(\"\");\r\n//        phoneNumbers.add(\"\");\r\n//        phoneNumbers.add(\"\");\r\n        phoneNumbers.add(\"9246465080\");\r\n        for(int i = 0;i < phoneNumbers.size();i++){\r\n            smsManager.sendTextMessage(phoneNumbers.get(i),null,\"HELP NEEDED! http://www.google.com/maps/place/\" + myPref.getString(\"Latitude\",\"0.00\") + \",\" + myPref.getString(\"Longitude\",\"0.00\"),null,null);\r\n        }\r\n\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/keephersafeGPStrial/DangerTrigger.java	(revision 5b526c8c9f9ec66b68cb6a5c65ab740279bcbe4b)
+++ app/src/main/java/com/example/keephersafeGPStrial/DangerTrigger.java	(date 1604372659072)
@@ -114,7 +114,7 @@
 //        phoneNumbers.add("");
         phoneNumbers.add("9246465080");
         for(int i = 0;i < phoneNumbers.size();i++){
-            smsManager.sendTextMessage(phoneNumbers.get(i),null,"HELP NEEDED! http://www.google.com/maps/place/" + myPref.getString("Latitude","0.00") + "," + myPref.getString("Longitude","0.00"),null,null);
+//            smsManager.sendTextMessage(phoneNumbers.get(i),null,"HELP NEEDED! http://www.google.com/maps/place/" + myPref.getString("Latitude","0.00") + "," + myPref.getString("Longitude","0.00"),null,null);
         }
 
     }
Index: app/src/main/java/com/example/keephersafeGPStrial/MainActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.keephersafeGPStrial;\r\n\r\nimport android.app.Activity;\r\nimport android.bluetooth.BluetoothAdapter;\r\nimport android.content.BroadcastReceiver;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.content.IntentFilter;\r\nimport android.content.SharedPreferences;\r\nimport android.os.Bundle;\r\n\r\nimport com.google.android.material.floatingactionbutton.FloatingActionButton;\r\nimport com.google.android.material.snackbar.Snackbar;\r\n\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.appcompat.widget.Toolbar;\r\nimport androidx.core.content.ContextCompat;\r\n\r\nimport android.telephony.SmsManager;\r\nimport android.view.Menu;\r\nimport android.view.MenuItem;\r\nimport android.view.View;\r\nimport android.widget.Button;\r\nimport android.widget.EditText;\r\nimport android.widget.Switch;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport org.w3c.dom.Text;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.Collection;\r\nimport java.util.Collections;\r\nimport java.util.List;\r\n\r\npublic class MainActivity extends AppCompatActivity {\r\n    private EditText editText;\r\n    TextView hearrateTV,avgHRV;\r\n    private BluetoothAdapter mBluetoothAdapter;\r\n    ArrayList<String> phoneNumbers;\r\n    SmsManager smsManager;\r\n    SharedPreferences myPref;\r\n    private Button sendSOS;\r\n    Switch simpleSwitch;\r\n    ArrayList<Double> hrvs;\r\n    double hrv;\r\n    int hrIndex = 0;\r\n    double tot = 0, mean, stdDev, scaleOfElimination = 1.5;\r\n\r\n\r\n    public void toast(String mess) {\r\n        Toast.makeText(this, mess, Toast.LENGTH_SHORT).show();\r\n    }\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_main);\r\n\r\n\r\n        sendSOS = findViewById(R.id.SOSbutton);\r\n        hearrateTV = findViewById(R.id.hearrateTV);\r\n        avgHRV = findViewById(R.id.avgHRV);\r\n        simpleSwitch = findViewById(R.id.simpleSwitch);\r\n\r\n        hrvs = new ArrayList (Collections.nCopies(100, 0.0));\r\n\r\n\r\n\r\n        sendSOS.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                sendManualSOS();\r\n            }\r\n        });\r\n\r\n        BluetoothAdapter bluetoothAdapter = BluetoothAdapter.getDefaultAdapter();\r\n        if(!bluetoothAdapter.isEnabled())\r\n        {\r\n            Intent intent = new Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);\r\n            startActivityForResult(intent,1);\r\n            try {\r\n                Thread.sleep(2000);\r\n            } catch (InterruptedException e) {\r\n                e.printStackTrace();\r\n            }\r\n        }\r\n\r\n        Intent i=new Intent(this,  MyBluetoothService.class);\r\n        startService(i);\r\n\r\n\r\n        ServiceToActivity serviceReceiver = new ServiceToActivity();\r\n        IntentFilter intentSFilter = new IntentFilter(\"ServiceToActivityAction\");\r\n        registerReceiver(serviceReceiver, intentSFilter);\r\n    }\r\n\r\n\r\n    public void startBtService(View view) {\r\n        BluetoothAdapter bluetoothAdapter = BluetoothAdapter.getDefaultAdapter();\r\n        if(!bluetoothAdapter.isEnabled())\r\n        {\r\n            Intent intent = new Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);\r\n            startActivityForResult(intent,1);\r\n            try {\r\n                Thread.sleep(2000);\r\n            } catch (InterruptedException e) {\r\n                e.printStackTrace();\r\n            }\r\n\r\n        }\r\n\r\n        Intent i=new Intent(this,  MyBluetoothService.class);\r\n        startService(i);\r\n    }\r\n\r\n    public boolean isEmergency(){\r\n\r\n        tot = 0;\r\n        for(double d : hrvs){\r\n            tot += d;\r\n        }\r\n\r\n        mean = tot / hrvs.size();\r\n\r\n\r\n        double temp = 0;\r\n\r\n        for (double a : hrvs) {\r\n            temp += (a - mean) * (a - mean);\r\n        }\r\n\r\n        stdDev = Math.sqrt(temp / (hrvs.size() - 1));\r\n\r\n\r\n        final List<Integer> newList = new ArrayList<>();\r\n\r\n\r\n        boolean isLessThanLowerBound = hrv < (mean - stdDev * scaleOfElimination);\r\n        boolean isGreaterThanUpperBound = hrv > (mean + stdDev * scaleOfElimination);\r\n        boolean isOutOfBounds = isLessThanLowerBound || isGreaterThanUpperBound;\r\n\r\n//        return !(hrv >=63 && hrv <= 87);\r\n        return isOutOfBounds;\r\n    }\r\n\r\n    public class ServiceToActivity extends BroadcastReceiver\r\n    {\r\n        @Override\r\n        public void onReceive(Context context, Intent intent)\r\n        {\r\n            Bundle notificationData = intent.getExtras();\r\n            String newData  = notificationData.getString(\"ServiceToActivityKey\");\r\n\r\n            // newData is from the service\r\n\r\n            String[]  data = newData.split(\";\");\r\n\r\n            if(data[0].equals(\"datapoint\")){\r\n                hrv = Double.parseDouble(data[1]);\r\n                hearrateTV.setText(\"Heart Rate Detected \" + hrv);\r\n\r\n                if(isEmergency() && !simpleSwitch.isChecked()){\r\n                    sendManualSOS();\r\n                }\r\n\r\n                if(simpleSwitch.isChecked())\r\n                {\r\n                    hrvs.set(hrIndex , Double.parseDouble(data[1]));\r\n                    hrIndex = (hrIndex + 1) % hrvs.size();\r\n\r\n                    avgHRV.setText(\r\n                             hrvs.toString() + \"\\n\\n\" +\r\n                            \"Average Heart Rate = \" + mean  + \" \\nStdDev =\" + stdDev + \"\\n\"\r\n                            + \"LowerBound = \" + (mean - stdDev * scaleOfElimination) + \"\\n\"\r\n                            + \"UpperBound = \" + (mean + stdDev * scaleOfElimination) + \"\\n\"\r\n                    );\r\n\r\n                }\r\n            }\r\n\r\n\r\n\r\n        }\r\n    }\r\n\r\n\r\n    public void startService(View v){\r\n\r\n        Intent serviceIntent  = new Intent(this,LocationService.class);\r\n        ContextCompat.startForegroundService(this,serviceIntent);\r\n    }\r\n    public void stopService(View v) {\r\n        Intent serviceIntent = new Intent(this, LocationService.class);\r\n        stopService(serviceIntent);\r\n    }\r\n\r\n    @Override\r\n    public int checkPermission(String permission, int pid, int uid) {\r\n        return super.checkPermission(permission, pid, uid);\r\n    }\r\n    public void sendManualSOS() {\r\n        myPref = getSharedPreferences(\"MySharedPref\",MODE_PRIVATE);\r\n\r\n        smsManager = SmsManager.getDefault();\r\n        phoneNumbers = new ArrayList<>();\r\n        phoneNumbers.add(\"9246465080\");\r\n        for(int i = 0;i < phoneNumbers.size();i++){\r\n            String tosend = \"HELP NEEDED!  \"+ hrv+ \"\\n http://www.google.com/maps/place/\" +  myPref.getString(\"Latitude\",\"0.00\") + \",\" + myPref.getString(\"Longitude\",\"0.00\");\r\n            toast(tosend);\r\n\r\n            smsManager.sendTextMessage(phoneNumbers.get(i),null,\"HELP NEEDED!  \"+ hrv+ \"\\n http://www.google.com/maps/place/\" + myPref.getString(\"Latitude\",\"0.00\") + \",\" + myPref.getString(\"Longitude\",\"0.00\"),null,null);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    protected void onDestroy() {\r\n        super.onDestroy();\r\n\r\n//        Intent i=new Intent(this,  MyBluetoothService.class);\r\n//        stopService(i);\r\n\r\n    }\r\n\r\n\r\n    @Override\r\n    public boolean onCreateOptionsMenu(Menu menu) {\r\n        // R.menu.actionbar is a reference to an xml file named actionbar.xml which should be inside your res/menu directory. \r\n        // If you don't have res/menu, just create a directory named \"menu\" inside res\r\n        getMenuInflater().inflate(R.menu.actionbar, menu);\r\n        return super.onCreateOptionsMenu(menu);\r\n    }\r\n\r\n    // handle button activities\r\n    @Override\r\n    public boolean onOptionsItemSelected(MenuItem item) {\r\n        int id = item.getItemId();\r\n\r\n        if (id == R.id.profile) {\r\n            // do something here\r\n        }\r\n        return super.onOptionsItemSelected(item);\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/keephersafeGPStrial/MainActivity.java	(revision 5b526c8c9f9ec66b68cb6a5c65ab740279bcbe4b)
+++ app/src/main/java/com/example/keephersafeGPStrial/MainActivity.java	(date 1604372646324)
@@ -209,7 +209,7 @@
             String tosend = "HELP NEEDED!  "+ hrv+ "\n http://www.google.com/maps/place/" +  myPref.getString("Latitude","0.00") + "," + myPref.getString("Longitude","0.00");
             toast(tosend);
 
-            smsManager.sendTextMessage(phoneNumbers.get(i),null,"HELP NEEDED!  "+ hrv+ "\n http://www.google.com/maps/place/" + myPref.getString("Latitude","0.00") + "," + myPref.getString("Longitude","0.00"),null,null);
+//            smsManager.sendTextMessage(phoneNumbers.get(i),null,"HELP NEEDED!  "+ hrv+ "\n http://www.google.com/maps/place/" + myPref.getString("Latitude","0.00") + "," + myPref.getString("Longitude","0.00"),null,null);
         }
     }
 
